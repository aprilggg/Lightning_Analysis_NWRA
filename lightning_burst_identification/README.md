# Lightning Burst Identification

* [Directory Overview](#directory-overview)
* [Lightning Burst Detection Methods](#methods)
* [Code Requirements](#requirements)
* [Output Files](#outputs)

<a id="directory-overview"></a>

### Directory Overview

The files in this directory include:
1. **`lightning_threshold_functions.py`**
    - contains functions used in both inner core and rainband analyses
    - functions include:
        - threshold calculation
        - threshold application
        - plotting wind/pressure/lightning/detected bursts
        - generating a TC-level summary
        - plotting basin-level threshold distributions
        - calculating basin-level thresholds
2. **`lightning_threshold_innercore.ipynb`**
    - applies threshold calculation, TC plotting functions to inner core dataset
    - identifies lightning bursts at individual TC level and basin level
    - generates .png files of TC wind/pressure/lightning/burst plots
    - creates data files used in intensification analysis and dashboard
3. **`lightning_threshold_rainband.ipynb`**
    - applies threshold calculation, TC plotting functions to rainband dataset
    - identifies lightning bursts at individual TC level and sorts them into shear quadrants
    - generates .png files of TC wind/pressure/lightning/burst plots at both overall and shear quadrant granularity
    - creates data files used in intensification analysis and dashboard
4. **`lightning_burst_dashboard.pbix`**
    - Power BI dashboard visualizing detected bursts in graphical and tabular form
    - includes both inner core and rainband lightning types
    - documentation can be found in [`dashboard_documentation.md`](dashboard_documentation.md)

Visualizations generated by the `lightning_threshold_rainband.ipynb` and `lightning_threshold_innercore.ipynb` notebooks are saved as .png files in the `visualizations/` folder and can also be found in this [Google Drive folder](https://drive.google.com/drive/folders/1iIZx4ThnT8KyQc6pDPAemjYb0Ma_OFd_?usp=drive_link). Refer to this [documentation](visualization_documentation.md) for details on file naming patterns.

This directory also includes basin-level lightning burst evaluation data in the `data/` folder not used in subsequent analysis. Files either contain just one basin (noted in file name), or contain all basins (no basin in file name).

<a id="methods"></a>

### Lightning Burst Detection Methods
We log transform the lightning counts per time bin and then calculate a lightning burst threshold based off each storm's log-lightning count distribution. Note that thresholds are evaluated off the log-lightning count, and threshold numbers are also represented on the log scale. We do not include counts associated with wind speeds less than 40 knots, and we do not include time bins with 0 lightning counts in the calculation of our thresholds.

In the lightning burst detection process, we use the following 6 threshold methods (referred to by the names in parentheses hereafter):
- [Median Absolute Deviation](https://en.wikipedia.org/wiki/Median_absolute_deviation) - 4 MAD (**MAD1**)
    - This method sets the threshold to be 4 times the median absolute deviation above the median log-lightning count
    - Equation: threshold = median + 4 * MAD
- Median Absolute Deviation - 5 MAD (**MAD2**)
    - This method sets the threshold to be 5 times the median absolute deviation above the median log-lightning count
    - Equation: threshold = median + 5 * MAD
- [Interquartile Range](https://en.wikipedia.org/wiki/Interquartile_range) - 1 IQR (**IQR1**)
    - This method sets the threshold to be 1 interquartile range higher than the upper quartile (Q3) log-lightning count
    - Equation: threshold = Q3 + 1 * IQR
- Interquartile Range - 1.5 IQR (**IQR2**)
    - This method sets the threshold to be 1.5 interquartile ranges higher than the upper quartile (Q3) log-lightning count
    - Equation: threshold = Q3 + 1.5 * IQR
- [Lognormal](https://en.wikipedia.org/wiki/Log-normal_distribution) - 2 Standard Deviations (**LOGN1**)
    - This method sets the threshold to be 2 standard deviations higher than the mean log-lightning count
    - Equation: threshold = mean + 2 * std dev
- Lognormal - 3 Standard Deviations (**LOGN2**)
    - This method sets the threshold to be 3 standard deviations higher than the mean log-lightning count
    - Equation: threshold = mean + 3 * std dev

**note that all methods use the log-lightning count as base (e.g. median refers to median log-lightning count, not median lightning count)


<a id="requirements"></a>

### Code Requirements
The lightning burst identification notebooks require the following libraries not built in to Python:
- pandas
- polars
- numpy
- matplotlib
- scipy

The `lightning_threshold_innercore.ipynb` and `lightning_threshold_rainband.ipynb` files import functions from the `lightning_threshold_functions.py` file.

<a id="outputs"></a>

### Output Files
The code in this directory outputs data files into both the [lightning_burst_identification/data/](data/) and [analysis_data/](../analysis_data/) directories. Basin-level threshold evaluations are in the [lightning_burst_identification/data/](data/) folder, and individual-level threshold evaluation datasets are in the [analysis_data/](../analysis_data/) folder, later used in both the dashboard and TC intensification statistical analysis. Individual TC visualizations are saved as .png files in the [visualizations/](visualizations/) folder.

**`analysis_data/`**
* innercore_bursts.csv
* innercore_lightning_data.csv
* innercore_threshold_summary.csv
* rainband_bursts.csv
* rainband_lightning_data.csv
* rainband_threshold_summary.csv

Schema details for these files can be found in [analysis_data/README.md](../analysis_data/README.md)